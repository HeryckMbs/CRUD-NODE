<main class="col-10 d-flex justify-content-center">

  <div class="container border border-3 border-success p-2 rounded" style="margin: 20px;">
    <h3 class="text-center">Lojas Cadastradas</h3>
    <div class="panel panel-default">
      <div class="panel-heading text" style="display: flex; margin: 10px;justify-content:center">
        <a onclick="modalG(0)" class="btn btn-primary text-center">
          Cadastrar Loja
        </a>
      </div>
      <div class="panel-body">
        <div class="table table-responsive">
          <table style="width: 100%;" class="table">
            <thead class="table-dark">
              <tr>
                <th>Número da Loja</th>
                <th>Rua</th>
                <th>Bairro</th>
                <th>Cidade</th>
                <th>Gerente</th>
                <th>Email do gerente</th>
                <th colspan="2">Ações</th>
              </tr>
            </thead>
            <tbody class="table-group-divider table-success table-bordered border-success">
              <% lojas.forEach(function(loja){ %>
              <tr>
                <td><%= loja.loja_id %></td>
                <td><%= loja.endereco %></td>
                <td><%= loja.bairro %></td>
                <td><%= loja.cidade %></td>
                <td><%= loja.primeiro_nome +" "+ loja.ultimo_nome %></td>
                <td><%= loja.email %></td>

                <td>
                  <a onclick="modalG('<%= loja.loja_id %>')" class="btn btn-warning" id="edit<%= loja.loja_id %>" ><i class="fa-solid fa-pencil"></i></a>
                </td>
                <td>
                  <a onclick="deleteLoja('<%= loja.loja_id %>')" class="btn btn-danger"><i class="fa-solid fa-trash"></i></a>
                </td>
              </tr>
              <% }) %>

            </tbody>
          </table>
        </div>
      </div>
      <div class="panel-footer"> 
      
      </div>
    </div>
  </div>

  



</main>

<script>
 

  function modalG(idLojaEdit) {
    $.ajax({
      method: "GET",
      url: '/lojamodal/'+idLojaEdit,
      data:{
        idLoja : idLojaEdit
      }
    }).done(function(html) {

    $('#modalLoja').empty();
    $('#modalLoja').append(html)
    $('#modalLoja').modal('show')

    })
  }

  function deleteLoja(idLojaDelete) {
    $.ajax({
      method: "DELETE",
      url: '/lojadelete',
      data: {
        idLoja: parseInt(idLojaDelete)
      },

    }).done(function(response) {
      alertify.success('Loja excluída!')
      setTimeout(() => location.reload(), 2000)
    }).fail(function(jqXHR, textStatus) {
      alertify.error('Não foi possível excluir a loja!')
    })
  }

  $('form').submit(function() {
    $(this)[0].reset();
  });
</script>

<% if(locals.success && success === true){ %>
<script>
  alertify.success('<%=message%>');
</script>
<% }else if(locals.success && success === false) { %>
<script>
  alertify.error('<%=message%>');
</script>
<% } %>